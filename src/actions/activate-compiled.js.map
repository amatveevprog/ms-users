{"version":3,"sources":["activate.js"],"names":[],"mappings":";;AAAA,MAAM,UAAU,QAAQ,UAAR,CAAV;AACN,MAAM,oBAAoB,QAAQ,wBAAR,CAApB;AACN,MAAM,MAAM,QAAQ,iBAAR,CAAN;AACN,MAAM,QAAQ,QAAQ,eAAR,CAAR;;AAEN,OAAO,OAAP,GAAiB,SAAS,eAAT,CAAyB,IAAzB,EAA+B;;;AAG9C,QAAM,EAAE,KAAF,EAAS,SAAT,EAAoB,QAApB,KAAiC,IAAjC,CAHwC;AAI9C,QAAM,EAAE,MAAF,KAAa,IAAb,CAJwC;AAK9C,QAAM,WAAW,KAAK,QAAL,IAAiB,OAAO,eAAP,CALY;;AAO9C,WAAS,WAAT,GAAuB;AACrB,WAAO,kBAAkB,MAAlB,CAAyB,IAAzB,CAA8B,IAA9B,EAAoC,KAApC,EAA2C,SAA3C,EAAsD,OAAO,UAAP,CAAkB,GAAlB,GAAwB,CAAxB,CAA7D,CADqB;GAAvB;;AAIA,WAAS,IAAT,CAAc,IAAd,EAAoB;AAClB,WAAO,KAAK,IAAL,CAAU,IAAV,CAAe,IAAf,EAAqB,gBAArB,EAAuC,IAAvC,EAA6C,QAA7C,CAAP,CADkB;GAApB;;AAIA,SAAO,QACJ,IADI,CACC,IADD,EACO,QADP,EAEJ,IAFI,CAEC,WAAW,MAAM,QAAN,GAAiB,WAA5B,CAFD,CAGJ,GAHI,CAGA,MAAM,eAAN,CAHA,CAIJ,GAJI,CAIA,IAJA,EAKJ,IALI,CAKC,QAAQ,CAAC,IAAD,EAAO,QAAP,CAAR,CALD,CAMJ,MANI,CAMG,IAAI,KAAJ,CANV,CAf8C;CAA/B","file":"activate-compiled.js","sourcesContent":["const Promise = require('bluebird');\nconst emailVerification = require('../utils/send-email.js');\nconst jwt = require('../utils/jwt.js');\nconst Users = require('../db/adapter');\n\nmodule.exports = function verifyChallenge(opts) {\n  // TODO: add security logs\n  // var remoteip = opts.remoteip;\n  const { token, namespace, username } = opts;\n  const { config } = this;\n  const audience = opts.audience || config.defaultAudience;\n\n  function verifyToken() {\n    return emailVerification.verify.call(this, token, namespace, config.validation.ttl > 0);\n  }\n\n  function hook(user) {\n    return this.hook.call(this, 'users:activate', user, audience);\n  }\n\n  return Promise\n    .bind(this, username)\n    .then(username ? Users.isExists : verifyToken)\n    .tap(Users.activateAccount)\n    .tap(hook)\n    .then(user => [user, audience])\n    .spread(jwt.login);\n};\n"]}