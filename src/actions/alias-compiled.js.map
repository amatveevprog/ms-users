{"version":3,"sources":["alias.js"],"names":[],"mappings":";;AAAA,MAAM,UAAU,QAAQ,UAAR,CAAV;AACN,MAAM,SAAS,QAAQ,eAAR,CAAT;;AAEN,MAAM,QAAQ,QAAQ,eAAR,CAAR;;AAGN,OAAO,OAAP,GAAiB,SAAS,WAAT,CAAqB,IAArB,EAA2B;AAC1C,QAAM,EAAE,QAAF,EAAY,KAAZ,KAAsB,IAAtB,CADoC;;AAG1C,SAAO,QACJ,IADI,CACC,IADD,EACO,QADP,EAEJ,IAFI,CAEC,MAAM,OAAN,CAFD,CAGJ,GAHI,CAGA,MAAM,QAAN,CAHA,CAIJ,GAJI,CAIA,MAAM,QAAN,CAJA,CAKJ,IALI,CAKC,QAAQ;AACZ,QAAI,MAAM,eAAN,CAAsB,IAAtB,CAAJ,EAAiC;AAC/B,YAAM,IAAI,OAAO,eAAP,CAAuB,GAA3B,EAAgC,2BAAhC,CAAN,CAD+B;KAAjC;;AAIA,WAAO,MAAM,UAAN,CAAiB,QAAjB,EAA2B,KAA3B,CAAP,CALY;GAAR,CALD,CAYJ,IAZI,CAYC,YAAY;AAChB,QAAI,aAAa,CAAb,EAAgB;AAClB,YAAM,IAAI,OAAO,eAAP,CAAuB,GAA3B,EAAgC,yBAAhC,CAAN,CADkB;KAApB;;AAIA,WAAO,MAAM,WAAN,CAAkB,QAAlB,EAA4B,KAA5B,CAAP,CALgB;GAAZ,CAZR,CAH0C;CAA3B","file":"alias-compiled.js","sourcesContent":["const Promise = require('bluebird');\nconst Errors = require('common-errors');\n\nconst Users = require('../db/adapter');\n\n\nmodule.exports = function assignAlias(opts) {\n  const { username, alias } = opts;\n\n  return Promise\n    .bind(this, username)\n    .then(Users.getUser)\n    .tap(Users.isActive)\n    .tap(Users.isBanned)\n    .then(data => {\n      if (Users.isAliasAssigned(data)) {\n        throw new Errors.HttpStatusError(417, 'alias is already assigned');\n      }\n\n      return Users.storeAlias(username, alias);\n    })\n    .then(assigned => {\n      if (assigned === 0) {\n        throw new Errors.HttpStatusError(409, 'alias was already taken');\n      }\n\n      return Users.assignAlias(username, alias);\n    });\n};\n"]}